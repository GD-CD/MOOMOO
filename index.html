<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Moo-ish Game</title>
  <style>
    body { margin: 0; background: #222; overflow: hidden; }
    canvas { display: block; background: #3a7d3a; }
  </style>
</head>
<body>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

// ===== PLAYER =====
const player = {
  x: 0,
  y: 0,
  r: 20,
  speed: 4,
  angle: 0,

  // Swing data
  swingAngle: 0,
  swingSpeed: 0,
  swinging: false
};

const mouse = { x: 0, y: 0 };
const keys = {};

// ===== INPUT =====
window.addEventListener("keydown", e => keys[e.key] = true);
window.addEventListener("keyup", e => keys[e.key] = false);

canvas.addEventListener("mousemove", e => {
  mouse.x = e.clientX;
  mouse.y = e.clientY;
});

canvas.addEventListener("mousedown", () => {
  if (!player.swinging) {
    player.swinging = true;
    player.swingSpeed = 0.25; // how fast the swing snaps forward
  }
});

// ===== CAMERA =====
function getCameraOffset() {
  return {
    x: canvas.width / 2 - player.x,
    y: canvas.height / 2 - player.y
  };
}

// ===== GRID =====
function drawGrid(cam) {
  const size = 50;
  ctx.strokeStyle = "#2f6f2f";
  ctx.lineWidth = 1;

  const startX = Math.floor((-cam.x) / size) * size;
  const startY = Math.floor((-cam.y) / size) * size;

  for (let x = startX; x < -cam.x + canvas.width; x += size) {
    ctx.beginPath();
    ctx.moveTo(x + cam.x, 0);
    ctx.lineTo(x + cam.x, canvas.height);
    ctx.stroke();
  }

  for (let y = startY; y < -cam.y + canvas.height; y += size) {
    ctx.beginPath();
    ctx.moveTo(0, y + cam.y);
    ctx.lineTo(canvas.width, y + cam.y);
    ctx.stroke();
  }
}

// ===== UPDATE =====
function update() {
  if (keys["w"]) player.y -= player.speed;
  if (keys["s"]) player.y += player.speed;
  if (keys["a"]) player.x -= player.speed;
  if (keys["d"]) player.x += player.speed;

  const cam = getCameraOffset();
  const worldMouseX = mouse.x - cam.x;
  const worldMouseY = mouse.y - cam.y;

  // Face the mouse
  player.angle = Math.atan2(worldMouseY - player.y, worldMouseX - player.x);

  // Swing animation
  if (player.swinging) {
    player.swingAngle += player.swingSpeed;
    player.swingSpeed -= 0.04;

    if (player.swingAngle <= 0) {
      player.swingAngle = 0;
      player.swinging = false;
      player.swingSpeed = 0;
    }
  }
}

// ===== DRAW PLAYER =====
function drawPlayer(cam) {
  const screenX = player.x + cam.x;
  const screenY = player.y + cam.y;

  ctx.save();
  ctx.translate(screenX, screenY);
  ctx.rotate(player.angle + player.swingAngle);

  // Body
  ctx.beginPath();
  ctx.arc(0, 0, player.r, 0, Math.PI * 2);
  ctx.fillStyle = "#d9d9d9";
  ctx.fill();

  // Weapon
  ctx.fillStyle = "#8b5a2b";
  ctx.fillRect(player.r, -4, 30, 8);

  // Weapon tip
  ctx.beginPath();
  ctx.moveTo(player.r + 30, 0);
  ctx.lineTo(player.r + 40, -6);
  ctx.lineTo(player.r + 40, 6);
  ctx.closePath();
  ctx.fillStyle = "#ccc";
  ctx.fill();

  ctx.restore();
}

// ===== DRAW =====
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  const cam = getCameraOffset();
  drawGrid(cam);
  drawPlayer(cam);
}

// ===== LOOP =====
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
